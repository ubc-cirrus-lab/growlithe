name: CodeQL coverage

on:
  push:
    branches: ['codeql-workflow-integration', 'coarse-grain-dataflow']

jobs:
  codeql:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run Queries
        id: query-results
        run: |
          chmod +x .github/codeql/run.sh
          .github/codeql/run.sh
          echo "text<<EOF" >> $GITHUB_OUTPUT
          cat ./high-level-flow/code/query_results/*.csv >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
        shell: bash

      - name: Print Results
        run: echo "${{ steps.query-results.outputs.* }}"
