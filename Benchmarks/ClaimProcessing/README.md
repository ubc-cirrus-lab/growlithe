# Claim Processing Application
The Claim Processing Application is a serverless application to manage insurance claims.
It allows users to submit claims, automatically assigns adjusters, and enables status updates. The application leverages AWS Lambda for compute, Amazon DynamoDB for data storage, and Amazon Cognito for user authentication. 

## Deployment

1. Install the AWS SAM CLI:
```
pip install aws-sam-cli
```

2. Update resources with custom names as required in `src` and `template.yaml`.

3. Replace the `template.yaml` and source code files with the provided ones.

4. Build the SAM application:
```
sam build
```

5. Deploy the SAM application:
```
sam deploy --guided
```

6. After deployment, the API Gateway endpoint URL will be displayed in the output. It should look similar to:
```
https://u6rhdcjpqe.execute-api.us-west-1.amazonaws.com/Prod/
```

## Creating Test Users

1. Ensure you have the `boto3` library installed:
```
pip install boto3
```

2. Update the Python script with your Cognito User Pool ID and desired user numbers:

```python
# Constants
USER_POOL_ID = "<YOUR_USER_POOL_ID>"
NUM_USERS = 5
NUM_ADJUSTERS = 2
START_AT = 1
```

3. Run the Python script to create users and adjusters:
```
cd scripts/
python create_cognito_users.py
```

4. The script will create the specified number of users and adjusters, and save their credentials in `user_credentials.csv` and `adjuster_credentials.csv` respectively.

## Obtaining Tokens for Test Users

To get an IdToken for API calls, use the AWS CLI:

```bash
IdToken=$(aws cognito-idp admin-initiate-auth \
  --user-pool-id <USER_POOL_ID> \
  --client-id <COGNITO_CLIENT_ID> \
  --auth-flow ADMIN_NO_SRP_AUTH \
  --auth-parameters USERNAME=<USERNAME>,PASSWORD=<PASSWORD> \
  --output text \
  --query 'AuthenticationResult.IdToken')
```

Replace `<USER_POOL_ID>`, `<COGNITO_CLIENT_ID>`, `<USERNAME>`, and `<PASSWORD>` with the appropriate values.
`<USER_POOL_ID>`, `<COGNITO_CLIENT_ID>` can be obtained from the AWS portal after deploying the user pool.
You can find the username and password in the CSV files generated by the script.

## Testing Endpoints

1. Add a new claim:
```bash
curl -H "Content-Type: application/json" \
     -H "Authorization: Bearer $IdToken" \
     -X POST  https://u6rhdcjpqe.execute-api.us-west-1.amazonaws.com/Prod/addClaim \
     -d '{"Name": "user1", "ClaimType": "dental"}'
```

2. Get a claim:
```bash
curl -H "Authorization: Bearer $IdToken" \
  https://icmtxzklgf.execute-api.us-west-1.amazonaws.com/Prod/getClaim/958566ea-0593-465e-912e-d8c1eb2a446d
```

3. Update a claim status:
```bash
curl -X PUT \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $IdToken" \
  -d '{"status": "APPROVED"}' \
  https://icmtxzklgf.execute-api.us-west-1.amazonaws.com/Prod/updateClaim/958566ea-0593-465e-912e-d8c1eb2a446d
```

**Note:** Make sure to replace the API endpoint URLs with the actual values from your deployment. Use relevant claim IDs in the API requests.

This updated README now incorporates the Python script for creating users, making it easier to set up and test the application.